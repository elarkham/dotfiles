#!/usr/bin/env bash
shopt -s extglob

pudgeInfo(){
    arg="$1"
    input="$(ssh pudge " echo '"/srv/http/$arg"'* ")"
    count="$(ssh pudge "ls -1 '"/srv/http/$arg"' | wc -l")"

    for i in `seq 2 "$((($count+1)))"`; do
    	list[$i]=$(echo $input | awk -v "x=$i" -v "arg=$arg" '{split($0,list,"/srv/http/"arg)} END{print list[x]}');
        list[$i]="${list[$i]%%*( )}"
    done
} 

navDir(){        
pudgeInfo "$1"
select choice in ".." "${list[@]}"; do
        for i in "${list[@]}"; do
                case $choice in 
                    '..') 
                        unset list
                        navDir "/";;
                    *.mkv)
                        tempURL="$1$choice"
                        encodedURL="$(perl -MURI::Escape -e 'print uri_escape($ARGV[0]);' "$tempURL")" 
                        mpv "http://elarkham.ssh.bz/$encodedURL";;
                    $i)
                        unset list
                        navDir "$1$i/";;
                esac
        done
done
}

navDir "/"
